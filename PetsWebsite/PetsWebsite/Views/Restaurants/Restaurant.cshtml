@section Styles{
    <link rel="stylesheet" href="~/css/AaronCSS/index.css" />
    <link rel="stylesheet" href="~/css/AaronCSS/favoriteIcon.css" />
    <link rel="stylesheet" href="~/lib/font-awesome/css/all.min.css" />
}

    <div id="Rest">

        <!-- Jumbotron -->
        <div class="container-fluid">
            <div class="row">
                <div class="jumbotron">
                    <div class="container">
                        <h1 class="display-3">Hello, world!</h1>
                        <p>
                            This is a template for a simple marketing or informational website. It includes a large callout
                            called a jumbotron and three supporting pieces of content. Use it as a starting point to create
                            something more unique.
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!--麵包屑-->
            <div class="container">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="~/Home/Index" style="text-decoration:none;">首頁</a></li>
                        <li class="breadcrumb-item"><a href="~/Restaurants/Restaurant" class="Clinic" style="text-decoration:none;">寵物友善餐廳</a></li>
                    </ol>
                </nav>
            </div>
        <!-- 依...搜尋... -->
        <div class="container">
 
            <div class="row row-cols-2 row-cols-sm-1 row-cols-md-2" >
                   
                <div class="col-8 d-flex justify-content-start mb-2" id="sel">
                    <select  class="me-2 form-control w-50" autocomplete="off" v-on:change="cheCity($event)" style="height:50px;">
                            <option value="" selected disabled>請選擇城市</option>
                            <option v-for="(item,index) in items" v-bind:value="index">{{item.CityName}}</option>
                    </select>
                    <select  class="me-2 form-control w-50" v-model="selected.area" style="height:50px;">
                            <option value="" selected disabled>請選擇地區</option>
                            <option v-for="region in regions" v-bind:value="region.AreaName">{{region.AreaName}}</option>
                    </select>
                    <button  class="btn btn-primary" v-on:click="Qry" style="height:50px;width: 75px;">查詢</button>
                </div>

                <div id="sel" class="col-4 d-flex justify-content-lg-end justify-content-sm-start justify-content-md-end" >
                    <input  type="text" placeholder="請輸入關鍵字.." class="form-control mb-2 w-50 me-2" style="height:50px;">
                    <button  class="btn btn-primary" style="height:50px;width: 60px;">查詢</button>
                </div>
            </div>

           
        </div>

        <!-- card -->
        <div class="container mt-3 ">
            <div class="row  row-cols-sm-1 row-cols-lg-2 row-cols-md-2 row-cols-xl-3" id="cardBody">
                
                <div id="inCard" v-for="(card,index) in restaurants" v-show="isShow">
                    <div class="card mb-4" id="cardContent">
                       <!-- 旋轉木馬 -->
                        <div :id="'pic'+index" class="carousel slide" data-bs-ride="true">
                            <div class="carousel-indicators">
                              <button type="button" :data-bs-target="'#pic'+index" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                              <button type="button" :data-bs-target="'#pic'+index" data-bs-slide-to="1" aria-label="Slide 2"></button>
                              <button type="button" :data-bs-target="'#pic'+index" data-bs-slide-to="2" aria-label="Slide 3"></button>
                            </div>
                            <div class="carousel-inner">
                              <div class="carousel-item active">
                                <img src="~/images/Owner/餐廳.jpg" class="d-block card-img-top" alt="...">
                              </div>
                              <div class="carousel-item">
                                <img src="~/images/Owner/餐廳.jpg" class="d-block card-img-top" alt="...">
                              </div>
                              <div class="carousel-item">
                                <img src="~/images/Owner/餐廳.jpg" class="d-block card-img-top" alt="...">
                              </div>
                            </div>
                            <button class="carousel-control-prev" type="button" :data-bs-target="'#pic'+index" data-bs-slide="prev">
                              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                              <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button" :data-bs-target="'#pic'+index" data-bs-slide="next">
                              <span class="carousel-control-next-icon" aria-hidden="true"></span>
                              <span class="visually-hidden">Next</span>
                            </button>
                          </div>

                        <div class="card-body">
                            <h4 class="card-title"><i class="fa-solid fa-utensils"></i> {{card.restaurantName}}</h4>
                            <p class="card-text"><i class="fa-solid fa-phone-volume"></i> {{card.phone}}</p>
                            <p class="card-text"><i class="fa-solid fa-location-dot"></i> {{card.city+card.region+card.address}}</p>
                            <div class="mb-2">
                                <p class="card-text"><i class="fa-solid fa-info"></i> 關於我們:</p>
                                <p class="card-text" id="cardAbout">{{card.introduction}}</p>
                            </div>
                            <div class="d-flex justify-content-center">
                                 <a href="#" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                                請按我
                            </a>
                            </div>
                           
                            <!-- Modal -->
                            <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false"
                             tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="staticBackdropLabel">{{card.restaurantName}}</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <!-- map -->
                                            <div class="container">
                                                <div class="row">
                                                    <h2 id="h2Text" class="col-12 text-center text-danger mb-2">Map</h2>
                                                    <div class="col-12">
                                                        <iframe id="map"
                                                            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3614.769612505944!2d121.52342931484193!3d25.041891483968584!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3442a970a11a84ad%3A0x58e05f2528812097!2z5ZyL56uL6Ie65YyX5ZWG5qWt5aSn5a24!5e0!3m2!1szh-TW!2stw!4v1657415255330!5m2!1szh-TW!2stw"
                                                            class="w-100" style="border:0;" allowfullscreen=""
                                                            loading="lazy"
                                                            referrerpolicy="no-referrer-when-downgrade"></iframe>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- 評論 -->
                                            <div class="container">
                                                <div class="row">
                                                    <h1 id="titleH1" class="text-danger mt-5">評論</h1>
                                                </div>
                                                <div class="row">

                                                    <div class="form-floating mt-3">
                                                        <textarea class="form-control" placeholder="Leave a comment here"
                                                              id="floatingTextarea2" style="height: 100px"></textarea>
                                                        <label for="floatingTextarea2">Comments</label>
                                                        <div class="d-flex justify-content-end mt-3">
                                                            <a href="#" class="btn btn-info">提交</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer d-flex justify-content-between">
                                            <div id="container" class="favorite">
                                                <div class="circle" v-on:click="toggle()"></div>
                                            </div>
                                            <button type="button" class="btn btn-secondary"
                                                data-bs-dismiss="modal">
                                                Close
                                            </button>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
    </div>
    @section Scripts{
    <script src="~/js/CityRegion.js"></script>
    <script>
        var app = new Vue({

            data: {
                items: [],
                restaurants: [],
                isShow: false,
                regions: [],
                total: {},
                selected: {
                    city: '',
                    area: '',
                }
            },
            methods: {
                Qry: async function() {
                    let that = this;
                    var a = await that.QryCityRegion()
                    return a;
                },

                QryCityRegion: function() {
                    let that = this;
                    let url = `/api/RestaurantsApi/QryByCityRegion/${that.selected.city}/${that.selected.area}/rawdata`
                    if (that.selected.area === "") {
                        axios.get(`/api/RestaurantsApi/QryByCityRegion/${that.selected.city}/rawdata`)
                            .then(res => {
                                console.log(res)
                                this.restaurants = res.data;
                                this.isShow = true;
                                console.log("載到囉!!城市查詢");

                            })
                            .catch(err => {
                                console.error(err);
                            })
                    }
                    else {
                        axios.get(url)
                            .then(res => {
                                console.log(res)
                                this.restaurants = res.data;
                                this.isShow = true;
                                console.log("載到囉!!複合查詢");

                            })
                            .catch(err => {
                                console.error(err);
                            })
                    }


                },
                cheCity: function(event) {
                    let that = this;
                    console.log(event);
                    that.regions = that.items[event.target.value].AreaList;
                    if (event.target.value === '0') {
                        that.selected.city = '台北';

                    }
                    if (event.target.value === '2') {
                        that.selected.city = '新北市';
                    }
                    that.selected.area = '';
                },
                toggle: function() {
                    document.getElementById('container').classList.toggle('is-active')

                }
            },
            mounted: function() {
                console.log('掛載完成');
                let that = this;
                that.items = JSON.parse(cityRegionSource);

                axios.get("/api/RestaurantsApi/Details/rawdata")
                    .then(res => {
                        console.log(res)
                        this.total = res.data;
                    })
                    .catch(err => {
                        console.error(err);
                    })
            }


        });
        app.$mount('#Rest')

    </script>
}
